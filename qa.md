# 1. Управление скоростью вращения корпусных вентиляторов через IPMI на платах Supermicro

## Применение
- Уменьшение шума.
- Требуется проверка перегрева после настройки.

## Инструкция
1. Подключение патчкорда к LAN-разъему IPMI.
2. Настройка IP в BIOS:
   - Вкладка: Advanced → IPMI configuration.
   - DHCP или Static IP.
3. Вход в Web-интерфейс IPMI через браузер.
4. Авторизация (логин/пароль: ADMIN).
5. Раздел Fan Mode → Set Fan to Optimal Speed → Save.

# 2. Настройка RAID массива на аппаратном RAID-контроллере LSI/Avago

## Требования
- Пример: Gigabyte H610M S2H DDR 4.

## Инструкция
1. Вход в BIOS (клавиша DEL).
2. Переключение в Advanced mode.
3. Вкладка: Settings → IO-Ports → LSI MegaRAID Configuration Utility.
4. Конфигурирование массива:
   - Очистка конфигурации.
   - Создание RAID 5.
   - Выбор дисков → Apply Changes.
   - Дополнительные настройки: Drive Cache (Enabled), Default Initialization (Fast).
5. Проверка состояния массива (Virtual Drive Management).
6. Инициализация массива через Gparted (Linux) или Управление дисками (Windows).

# 3. Восстановление ОС через систему восстановления IPDROM

## Важно
- Восстановление стирает пользовательские данные.

## Инструкция
1. Вход в BIOS (DEL/F2).
2. Выбор загрузки через Boot Override (UEFI Transcend Partition 1).
3. В оболочке восстановления:
   - Выбрать раскладку клавиатуры.
   - Поиск и устранение неисправностей → Средство восстановления.
   - Выбрать ОС для восстановления.
   - Указать системный диск.
4. Подтвердить действие (Y) и дождаться завершения процесса.
5. Перезагрузка сервера.

# 4. Сбор логов для анализа (RAID контроллер и серверы Supermicro)

## RAID контроллер (LSI/AVAGO)
1. Утилита: MegaRAID Storage Manager.
2. Сохранение логов через Save TTY Log.
3. Отправка файла на email (с указанием серийного номера сервера).

## Сервера Supermicro
1. Утилита: Supermicro Doctor.
2. Вход (логин/пароль: ADMIN).
3. Генерация отчетов (System Information, Event Log).
4. Отправка отчетов на email.

# 5. Диагностика звуковых сигналов

## Звуковые сигналы RAID контроллера
1. Проверка состояния массива через MegaRAID Storage Manager.
2. Отключение сигнала (Silence Alarm).
3. Восстановление диска:
   - Change to Unconfigured Good.
   - Import Foreign Configuration.

## Звуковые сигналы материнской платы
- Ошибки диагностируются по таблице звуковых сигналов (см. документ).

# 6. Переключение видеокарт на платах Supermicro

## Видеокарты
- Aspeed Graphics (VGA) или дискретная видеокарта.

## Инструкция
1. Выключить сервер.
2. Изменить положение перемычки JPG1:
   - 1-2: Aspeed Graphics.
   - 2-3: Дискретная видеокарта.
3. Подключить кабели к выбранной видеокарте.

# 7. Регистратор не включается 

## Восстановление заводского образа ОС (Linux) при помощи Clonzilla
1. Перезагрузите устройство и запустите boot menu нажимая клавишу “F12”
2. При открытии Boot menu выберете загрузку с USB накопителя Sandisk (64Gb) Partition 1, на которую установлена Clonezilla
3. Дождитесь загрузки оболочки восстановления.
4. Выберете пункт Clonezilla live (VGA 800x600 To RAM) -> нажмите клавишу “Enter”
5. Выберите язык – en_US. UTF-8 English и нажмите клавишу “Enter”
6. Выберете пункт Keep -> нажмите клавишу “Enter”
7. Выберете пункт Start_Clonezilla -> нажмите клавишу “Enter”
8. Выберете пункт device-image -> нажмите клавишу “Enter”
9. Выберете пункт local_dev -> нажмите клавишу “Enter”
10. Нажмите Enter
11. Выберете пункт Нажмите клавишу “Enter”Ctrl-C
12. Выберете USB накопитель, на который установлена Clonezilla Sandisk (64Gb) -> нажмите клавишу “Enter”
13. Выберите пункт no-fsck -> нажмите клавишу “Enter”
14. С помощью стрелок на клавиатуре выберите пункт – <Done> и нажмите клавишу “Enter”
15. Нажмите Enter
16. Выберете пункт Beginer -> нажмите клавишу “Enter”
17. Выберете пункт Restoredisk -> нажмите клавишу “Enter”
18. Выберите образ диска восстановления IPDROM_Recovery 256Gb
19. Пробелом укажите системный диск объемом 240/250Gb и подтвердите выбор нажав “Enter”
20. Выберете пункт “-scr No Skip check” -> нажмите клавишу “Enter”
21. Выберете пункт -p reboot -> нажмите клавишу “Enter”
22. Нажмите клавишу “Enter”
23. Введите «Y» -> нажмите клавишу “Enter”
24. Введите «Y» -> нажмите клавишу “Enter”

# 8. Отображение ряда сообщений

## Рекомендация
1. Восстановить заводской образ ОС

# 9. Не загружается операционная система ubuntu

## Рекомендация
- Стоить проверить логи

## Решение
1. Обновлялся ли конфиг для видео драйвера?
2. Если конфиг обновлялся, то стоит вернуть ОС к заводским настройкам

# 10. Черный экран в IPMI

## Примечание
- Такое может происходить по причине того, что в сервере используется две видеокарты. 
- По умолчанию сервер может быть настроен на вывод изображения с видеокарты Intel UHD Graphics которая интегрирована в процессор. Она выводит изображение только на цифровые видеовыходы сервера. (HDMI, DVI-I, DisplayPort.)
- Также может быть установлена дискретная видеокарта с различными видеовыходами.
- За работу IPMI отвечает только аналоговый порт VGA, и видеокарта на материнской плате - Aspeed Graphics. 
- Одновременно две видеокарты работать не могут! Пользователю придется выбрать что-то одно.

## Для того чтобы переключить активную видеокарту на мат платах Supermicro, выполните следующие действия: 
1. Выключите сервер IPDROM.
2. На материнской плате найдите перемычку - JPG1
3. В зависимости от ее положения выбирается активная видеокарта.
4. Положение - 1-2 (+ Включено) - Включена встроенная в мат плату видеокарта Aspeed (IPMI, Порт VGA)
5. Положение - 2-3 (- Выключено) - Используется дискретная видеокарта или встроенная в ЦП (Порты - HDMI, DVI-I, DisplayPort).
6. Переключите видеокарту в нужный вам режим.
7. Подключите кабели монитора к видеовыходам мат платы в зависимости от выбранной видеокарты.

# 11. Потеря связи с камерами

## Рекомендация
- Стоить проверить диски на битые секторы

## Решение
1. Для поиска битых секторов можно использовать утилиту badblocks. Если вам надо проверить корневой или домашний раздел диска, то лучше загрузится в LiveCD, чтобы файловая система не была смонтирована. Все остальные разделы можно сканировать в вашей установленной системе. Вам может понадобиться посмотреть какие разделы есть на диске. Для этого можно воспользоваться командой fdisk:
`sudo fdisk -l /dev/sda1`
2. Более детально можно узнать по [ссылке](https://losst.pro/proverka-diska-na-bitye-sektory-v-linux)

# 12. Пропало видеоизображение на мониторах

## Рекомендации
1. Скорее всего, у вас по умолчанию сервер настроен на вывод изображение через порт VGA. 
2. Остальные порты на сервере при этом работать не будут, т.к. за вывод изображения на них отвечает видеокарта встроенная в ЦП - Intel UHD Graphics 630.
3. По умолчанию данная видеокарта отключена. Е
4. сли изображения нет на порту VGA, то в первую очередь проверьте кабель и монитор. 
5. Попробуйте на время теста подключить др монитор и использовать др кабель. 

## Решение
Если изображение получить по-прежнему не удается, то вы можете попробовать переключить видеокарту на встроенную в ЦП. 
Для этого сделайте следующее: 
1. Выключите сервер IPDROM.
2. На материнской плате найдите перемычку - JPG1
3. В зависимости от ее положения выбирается активная видеокарта.
4. Положение - 1-2 (Включено) - Включена встроенная в мат плату видеокарта Aspeed
5. Положение - 2-3 (Выключено) - Используется дискретная видеокарта или встроенная в ЦП
6. Переключите видеокарту в нужный вам режим.
7. Подключите кабели монитора к видеовыходам мат платы в зависимости от выбранной видеокарты.

*Одновременно две видеокарты работать не могут! Пользователю придется выбрать что-то одно.*

# 13. Алгоритм добавления дополнительных камер

## Рекомендации
- По вопросам настройки софта ITV, просьба связаться с технической поддержкой, по номеру телефона - `+7 (495) 665-83-73`

# 14. Проблема с записью архива, пропуски кадров

## Рекомендация
1. Рекомендуется скачать [Crystal disk mark](https://sourceforge.net/projects/crystaldiskmark/files/8.0.5/CrystalDiskMark8_0_5.zip/download)
2. Сделать замеры скорости ввода/вывода Raid-массива. Нужно чтобы ничего параллельно не велась запись, иначе результаты будут неверными
3. После получения результат. Если результаты на поток на запись будет выше чем выдает RAID, то проблема в настройках Интеллект - нужно корректировать настройки, чтобы RAID справлялся
4. Также рекомендуется на время тестов отключить Firewall и антивирус т к они могут существенно влиять на фильтрацию сетевого трафика

## Решение
1. Стоит проверить настройки массивов на режим работы 
2. Если стоит в режиме - Write Through, то стоит поменять на - Always Write Back

# 15. Отмонтировался RAID-массив

## Рекомендации
1. Проверить, что массив в ОС видится и подмонтирован корректно
2. Теперь необходимо проверить настройки RAID массива.
3. Для этого выполните последовательно следующие команды:
```
echo 'deb http://hwraid.le-vert.net/debian stretch main' | sudo tee -a /etc/apt/sources.list
sudo wget -O - https://hwraid.le-vert.net/debian/hwraid.le-vert.net.gpg.key | apt-key add -
sudo apt update
sudo apt-get install megacli
```
4. После этого будет установлена утилита управления и мониторинга аппаратным RAID массивом.
5. Затем введите команду:
```
MegaCli -LDInfo -Lall -aALL
```
6. При загрузки, Intellect X указать, его в качестве архивного для записи и проверить, как будет записываться и считываться архив

# 16. Сервер не активен после перезагрузки, черны экран

## Рекомендация
Рекомендую проверить настройки гибернации в ОС - возможно сервер переходит в нее после некоторого времени и не может корректно выйти.

# 17. Выскакивает ошибка SSD, не запускается Axxon

## Рекомендация
1. Если ОС загружается нормально, но при этом Axxon не загружается, то проблема может быть в поврежденных файлах Axxon, а не в SSD
2. Проверить накопитель на ошибки, команда для выполнения в терминале:
```angular2html
sudo sudo apt install smartmontools
sudo smartctl --scan 
```
3. Будет выведен список всех дисков. Для систменого диска:
```angular2html
sudo smartctl -a -d  /dev/nvme0 -d nvme >> "$(hostname)_disks.txt 
```
4. После сканирования диска результат будет сохранен в файл - disks.txt
5. Пришлите файл нам на анализ
6. Если отсутствует выбор Restoredisk. То проверь USB накопитель подключенный внутри сервера на материнской плате
7. Извлеките его из передника и подключите в любой ПК с ОС Windows
8. Откройте накопитель для просмотра в проводнике
9. В корне диска у вас должна быть папка - IPDROM_recovery

## Решение
1. Вернуть к заводским настройкам 

# 18. Не загружается сервер

## Если сервер не загружается, то для восстановления его работоспособности рекомендуется восстановить заводской образ ОС
1. При загрузке сервера наживайте DEL или F2 для входа в BIOS
2. Затем после входа в BIOS нажмите F6 для переключения в режим - Advanced mode
3. Далее перейдите на вкладку - Exit и в разделе Boot Override выберите для загрузки накопитель - Kingston DataTraveler 3.0 USB Device (Partition 1)
4. У вас загрузится оболочка восстановления ОС
5. На первом шаге выберите раскладку клавиатуры - Английская (Индия)
6. Далее выберите пункт - Поиск и устранение неисправностей
7. Затем выберите пункт - Средство восстановления
8. У вас откроется окно коммандной строки со списком дисков
9. Вам необходимо выбрать из списка ваш системный диск объемом 240Gb (или чуть меньше) и указать его номер
10. Пример:
    - После того как вы выбрали диск и указали его номер нажмите - Y для запуска процедуры восстановления заводского образа ОС.
    - После того как процесс завершится, перезагрузите сервер.
    - У вас должна будет загрузиться ОС в штатном режиме.

# 19. При запуски черный экран, сервер не работоспособен

## Рекомендации
1. Протестировать материнскую плату, возможно поменять на другую
2. Проверить БП. Проверить работу с аналогичным БП. Если с ним запуститься, то проблема в БП
3. Если нет, то стоит обратиться в серверный центр

# 20.  Как восстановить OC Ubuntu с системы восстановления

## Восстановление заводского образа ОС (Linux) при помощи Clonzilla 
1. Перезагрузите устройство и запустите boot menu нажимая клавишу “F12” 
2. При открытии Boot menu выберете загрузку с USB накопителя Sandisk (64Gb) Partition 1, 
на которую установлена Clonezilla  
3. Дождитесь загрузки оболочки восстановления.  
4. Выберете пункт Clonezilla live (VGA 800x600 To RAM) -> нажмите клавишу “Enter” 
5. Выберите язык – en_US. UTF-8 English и нажмите клавишу “Enter” 
6.  Выберете пункт Keep -> нажмите клавишу “Enter”      
7.  Выберете пункт Start_Clonezilla -> нажмите клавишу “Enter” 
8. Выберете пункт device-image -> нажмите клавишу “Enter” 
9. Выберете пункт local_dev -> нажмите клавишу “Enter” 
10. Нажмите Enter 
11. Выберете пункт Нажмите клавишу “Enter”Ctrl-C 
12. Выберете USB накопитель, на который установлена Clonezilla Sandisk (64Gb) -> нажмите клавишу “Enter” 
13. Выберите пункт no-fsck -> нажмите клавишу “Enter” 
14. С помощью стрелок на клавиатуре выберите пункт – <Done> и нажмите клавишу “Enter” 
15. Нажмите Enter 
16. Выберете пункт Beginer -> нажмите клавишу “Enter” 
17. Выберете пункт Restoredisk -> нажмите клавишу “Enter” 
18. Выберите образ диска восстановления IPDROM_Recovery 256Gb 
19. Пробелом укажите системный диск объемом 240/250Gb и подтвердите выбор нажав “Enter” 
20. Выберете пункт “-scr No Skip check” -> нажмите клавишу “Enter” 
21. Выберете пункт -p reboot -> нажмите клавишу “Enter” 
22. Нажмите клавишу “Enter” 
23. Введите «Y» -> нажмите клавишу “Enter” 
24. Введите «Y» -> нажмите клавишу “Enter”

# 21. Поменять имя сервера в AxxonNext

## Для изменения имени выполните следующие действия: 
1. Откройте терминал и введите - `sudo su`
2. Введите пароль администратора (По умолчанию: `ipdrom`)
3. Затем введите команду - `sudo nano /opt/AxxonSoft/AxxonNext/instance.conf`
4. В открывшемся конфигурационном файле измените имя регистратора на нужное вам.
5. Затем нажмите `Ctrl+X` и нажмите `Y` для сохранения изменений.
6. Далее введите команду - `reboot` для перезагрузки регистратора.
7. После перезагрузки, имя регистратора в ОС и Axxon должно будет измениться на ваше.

# 22. Пусконалодочные работы и настройки сервера
1. В комплектации с сервером у вам идет USB накопитель IPDROM на нем имеется сертификат на изделие и руководство по эксплуатаци
2. Инструкция по настройке [ПО Интеллект](https://docs.itvgroup.ru/confluence/pages/viewpage.action?pageId=128923530)
3. Ссылка на документы для [загрузки](https://docs.itvgroup.ru/confluence/pages/viewpage.action?pageId=119016432)

# 23. Сервер уходит в синий экран, виснет или перезагружается

## Рекомендации
1. Проверить ОЗУ
2. Протестировать SSD
3. Поставить ОС на другой накопитель
4. Переустановить ОС

# 24. Проблемы с черным экраном

## Рекомендации
1. В ОС Ubuntu 22.04 выполнить настройку video-dummy с графикой intel не представляется возможным. К некорректной работе GUI приводят конфигурации xorg.conf.
2. Для работы с Ubuntu 22.04 с anydesk необходимо выполнить настройку `/etc/gdm3/custom.conf`
3. Указав значение `WaylandEnable=false`
5. И удалить все конфигурации xorg: `sudo rm -r /etc/X11/xorg.conf.d/*`
6. При восстановление системы через LiveCD:
7. Загрузите установочный дистрибутив [Ubuntu 22.04](https://releases.ubuntu.com/jammy/ubuntu-22.04.5-desktop-amd64.iso)
8. Запишите установочный дистрибутив на USB накопитель используя [утилиту](https://rufus.ie/ru/)
9. Подключите USB накопитель в проблемный регистратор с черным экраном при загрузке ОС.
10. Загрузитесь с USB накопителя Ubuntu выбрав пункт - Try Ubuntu (Попробовать Ubuntu)
11. Перемонтируйте системный диск: `sudo mount /dev/nvme0n1p2 /mnt`
12. Удалите конфигурации xorg: `sudo rm -r /etc/X11/xorg.conf.d/*`
13. Для работы системы без подключённого монитора может потребоваться временное подключение монитора для инициализации графического интерфейса. Если постоянное подключение невозможно, можно использовать эмулятор монитора.

# 25. Проблемы с сетевым подключением LAN

## Рекомендации
1. Такая проблема может происходить по причине того, что в ОС Ubuntu по умолчанию не созданы профили подключения. Из-за этого может происходить конфликт настроек сети.
2. Рекомендуется зайти в сетевые настройки подключения и создать новый профиль подключения с нужными параметрами.
3. После этого необходимо перезагрузить регистратор.

# 26. Плат сухих контактов. отображение в диспетчере устройств

## Рекомендации
- Платы лучей/реле должны быть установлены в корпус, но либо не подключены, либо подключены неверно, т.к. в разделе USB устройств нет - SL USB IO
- В сервере установлены 2 платы лучей/реле USB-IO 16/8
- Они должны отображаться в диспетчере устройств в разделе контроллеры USB
- Если платы там не отображаются, то значит неверно подключен шлейф от луча/реле к матплате. В таком случае необходимо при подключении к мат плате перевернуть коннектор на шлейфе на 180 градусов.
- Затем необходимо установить драйвера на платы.
- Драйвера идут в составе [ПО Интеллект](https://www.itv.ru/support/downloads/intellect.html)
- Достаточно указать папку с дистрибутивом ПО Интеллект в качестве источника для поиска драйверов и ОС сама их поставит.
- После чего необходимо перезагрузить сервер.

# 27. Вылетает программа и отключаются камеры

## Возможные проблемы
- Проверить драйвер видеокарты и обновить драйвер
- Откройте терминал и залогиньтесь под root. 
- Затем введите команду:
```angular2html
apt remove nvidia-driver 550 #это удалит текущий драйвер nVidia из ОС
apt install nvidia-driver 525 #это установит обновленный драйвер nVidia в ОС
```
- Затем перезагрузите ваш ПК и проверьте работу ПО Intellect X

# 28. Не включается регистратор

## Рекомендации
- Проверка RAID-массив
- Проверка БП

# 29. Ошибка диска из массива для хранения данных (HotSpare)

## Пояснение
- Данное состояние не является ошибкой. 
- У вас 1 диск настроен в режим горячей замены. (HotSpare) 
- Если любой из дисков в составе массива выйдет из строя, то данный диск автоматически встанет на место неисправного, без потери работоспособности всего RAID массива в целом.  

## Для проверки работоспособности 
1. Выберите любой диск входящий в состав массива и нажмите по нему правой кнопкой мыши. Затем выберите пункт - Make drive offline.
Согласитесь с предупреждением которое выдаст контроллер.
После этого выбранный диск в дереве дисков будет помечен красным.
Контроллер запищит сиреной, а диск HotSpare должен автоматически встать на место диска который offline. Также у диска hotspare появится в скобках приписка - (Rebuilding). За ходом процесса можно наблюдать на вкладке - Dashboard в правом столбце (Background Operations)
Чтобы выключить сирену на контроллере, нажмите по нему правой кнопкой мыши и выберите пункт - Silence Alarm.

2. Чтобы вернуть все назад как было, выберите диск в деревере который вы перевели в offline. Нажмите по нему правой кнопкой мыши, выберите пункт - Make Drive Online.
После этого диск должен вернуться в изначальное состояние, а диск HotSpare также должен помечаться как HotSpare в дереве. Если этого не произошло автоматически, то нажмите по нему пр кнопкой мыши в выберите пункт - Assingn Global HotSpare.

# 30. После замены дисков, появился странный звук

## Рекомендации
- Проверить RAID-массив
- Попробовать вернуть диск в массив
- Если не получается, скорее всего диск вышел из строя